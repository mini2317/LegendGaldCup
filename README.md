# 레전드 갈드컵 (Legend GaldCup) Discord Bot

디스코드 서버에서 익명으로 치열한 토론(갈드컵)을 열어주는 AI 기반 자동 봇입니다. 
구글의 Gemini AI를 활용하여 끝없이 흥미롭고 논쟁적인 주제를 던지고, 3일마다 투표 결과를 분석하여 아름다운 차트 이미지와 함께 공지합니다.

## 핵심 기능 (Features)
1. **AI 기반 주제 자동 생성**: 더 이상 고민할 필요 없이, 봇이 스스로 자극적이고 재밌는 딜레마를 생산합니다.
2. **로컬 및 글로벌 익명 의견 송출**: 다른 디스코드 서버에서 나온 익명 반응과 우리 서버 내 반응을 종합해 보여줍니다.
3. **AI 여론 군집화 차트 시각화**: 투표가 끝나면 AI가 사람들의 의견 텍스트를 분석해 파벌(카테고리)을 분류하고 시각적인 트리맵 비율 차트로 정리해줍니다.
4. **옵션별 상세 설명 지원**: 투표 메뉴엔 옵션 이름만 간단히, 공지와 모달엔 상세한 상황 설명이 제공됩니다.
5. **AI 이미지 프롬프트 삽입**: AI가 제시한 주제에 어울리는 대표 이미지를 인터넷에서 즉석 생성해 띄워줍니다.
6. **강력한 관리자 대기열 (Queue) 시스템**: `!AI주제충전` 명령어로 미리 대기열을 채워두거나, `!주제관리` 인터페이스에서 마음에 안 드는 부분의 제목, 옵션 텍스트를 맘대로 수정하고 삭제할 수 있습니다.

## 설치 및 실행 방법 (Installation & Usage)

1. 봇 레포지토리를 클론하거나 다운로드 받아 터미널에 엽니다.
2. 리눅스(Ubuntu/Debian 등) 환경의 경우, 제공되는 **자동 셋업 스크립트**를 실행하면 Python 설치부터 봇 구동까지 원클릭으로 진행됩니다.
   ```bash
   chmod +x start_bot.sh
   ./start_bot.sh
   ```
   *(이 스크립트는 시스템에 Python3이 없다면 자동으로 설치하고, 파이썬 가상환경(`venv`) 구성, `requirements.txt` 설치, 그리고 `nohup`을 통한 24시간 백그라운드 구동까지 모두 책임집니다.)*

3. 수동으로 설치를 원하거나 Windows 환경인 경우 다음 명령어를 차례로 실행하세요:
   ```bash
   python -m venv venv
   source venv/bin/activate  # Windows의 경우: venv\Scripts\activate
   pip install -r requirements.txt
   python main.py
   ```

4. 봇을 처음 구동하기 전에 반드시 `.env.example` 파일을 복사하여 `.env` 파일로 이름을 변경하고 아래 값들을 채워주세요.
   ```env
   DISCORD_TOKEN=당신의_디스코드_봇_토큰
   GEMINI_API_KEY=당신의_제미나이_API_키
   MASTER_ADMIN_ID=총관리자의_디스코드_유저아이디(숫자형)
   GEMINI_MODEL=gemini-2.5-flash
   ```

## 주요 명령어 (Commands)
* **`/설정` (관리자)**: 현재 채널을 갈드컵 투표 및 공지 채널로 등록/해제합니다. 등록 시 과거 진행! 중이던 투표 패널이 불러와집니다.
* **`/투표`**: 진행 중인 주제에 짧은 익명 의견과 함께 투표합니다.
* **`/주제제시`**: 봇이 골라줬으면 하는 재밌는 주제를 제안합니다. 이미지와 부를 설명까지 쓸 수 있습니다.
* **`/현재상황`**: 지금까지 몇 명이 각 항목에 투표했는지 통계와 최신 익명 의견들을 봅니다.

### 2. 주요 관리자 전용 명령어

*(이 명령어들은 기본적으로 `MASTER_ADMIN_ID`가 지정한 총관리자 및 부관리자 권한이 있는 유저만 실행 가능합니다.)*

- `!주제관리`: 
  현재 유저들이 `/주제제시`로 제안한 전체 후보 주제 목록을 열람하고, 이를 승인하여 대기열(Queue)에 예약할 수 있습니다.
  - 버튼 기능: `[대기열 추가]`, `[강제 시작]`, `[주제 수정]`, `[삭제]`, `[AI 가공 후 추가]`
- `!대기열관리`:
  실제로 봇이 다음에 송출할 확정된 주제 대기열을 열람하고 순서를 변경하거나 강제 시작할 수 있습니다.
- `!AI주제충전 [개수]`: 
  대기열이 비어있을 때를 대비해, 지정한 개수만큼 AI가 생성한 주제를 대기열에 선입력해둡니다.
- `!주제강제종료`: 
  현재 3일이 지나지 않았더라도 강제로 투표를 마감하고 통계를 내보낸 뒤 대기열의 다음 주제로 곧장 넘어갑니다.
- `!업데이트`: 
  **(총관리자 전용)** Github 저장소의 최신 코드를 즉시 패치(`fetch/reset`)하고 봇 프로세스를 강제로 안전하게 재기동합니다.
- `!부관리자추가 / !부관리자제거`: 
  **(총관리자 전용)** 다른 유저를 봇 관리자로 임명하여 `!주제관리` 등의 봇 제어 권한을 부여합니다.
- `!관리자목록`: 
  현재 봇을 제어할 수 있는 총관리자 및 부관리자 현황을 출력합니다.

## 라이선스
MIT License
